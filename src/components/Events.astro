---
const venues = [
  {
    name: "Czech Republic",
    city: "Prague (The Caffeine Rave)",
    year: "2026",
    flyer:
      "https://res.cloudinary.com/dflhguvio/image/upload/v1770924237/WhatsApp_Image_2026-02-12_at_1.19.30_PM_hqno5p.jpg",
  },
  {
    name: "Mexico",
    city: "Chihuahua (Studio Bar)",
    year: "2025",
    flyer:
      "https://res.cloudinary.com/dflhguvio/image/upload/v1770924380/WhatsApp_Image_2026-02-12_at_1.26.02_PM_plveyh.jpg",
  },
  {
    name: "Mexico",
    city: "Chihuahua (Ambar)",
    year: "2025",
    flyer:
      "https://res.cloudinary.com/dflhguvio/image/upload/v1770924474/WhatsApp_Image_2026-02-12_at_1.27.33_PM_sznsub.jpg",
  },
  {
    name: "Mexico",
    city: "Chihuahua (Studio Bar)",
    year: "2025",
    flyer:
      "https://res.cloudinary.com/dflhguvio/image/upload/v1770924537/WhatsApp_Image_2026-02-12_at_1.28.38_PM_guu2d8.jpg",
  },
  {
    name: "Mexico",
    city: "Chihuahua (El Camino Mezcaler√≠a)",
    year: "2025",
    flyer:
      "https://res.cloudinary.com/dflhguvio/image/upload/v1770924645/WhatsApp_Image_2026-02-12_at_1.29.51_PM_bdx4tk.jpg",
  },
];
---

<section id="venues" class="py-32 px-6 md:px-12 lg:px-24">
  <div class="container mx-auto max-w-5xl">
    <h2 id="venues-title" class="text-sm uppercase tracking-ultra-wide text-off-white/40 mb-16">
      Performed At
    </h2>

    <div class="space-y-6">
      {
        venues.map((venue, index) => (
          <div class="venue-item border-b border-off-white/10">
            <button
              class="venue-trigger w-full flex items-baseline justify-between py-4 text-left transition-colors duration-300"
              data-venue-index={index}
              aria-expanded="false"
            >
              <div class="space-y-1">
                <h3 class="venue-name text-2xl md:text-3xl font-light text-off-white transition-colors duration-300">
                  {venue.name}
                </h3>
                <p class="text-sm text-off-white/50">{venue.city}</p>
              </div>
              <span class="text-off-white/40 text-sm">{venue.year}</span>
            </button>

            <div
              class="venue-content overflow-hidden transition-all duration-300 ease-out"
              style="max-height: 0; opacity: 0;"
              data-venue-content={index}
            >
              <div class="py-8 flex justify-center">
                <div class="w-full max-w-md">
                  <img
                    src={venue.flyer}
                    alt={`${venue.name} flyer`}
                    class="w-full h-auto"
                    loading="lazy"
                  />
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  let currentlyOpen: number | null = null;

  function toggleVenue(index: number) {
    const triggers = document.querySelectorAll(".venue-trigger");
    const contents = document.querySelectorAll(".venue-content");
    const names = document.querySelectorAll(".venue-name");

    if (currentlyOpen === index) {
      const content = contents[index] as HTMLElement;
      content.style.maxHeight = "0";
      content.style.opacity = "0";
      content.style.transform = "translateY(-8px)";

      triggers[index].setAttribute("aria-expanded", "false");
      names[index].classList.remove("text-accent");

      currentlyOpen = null;
    } else {
      if (currentlyOpen !== null) {
        const prevContent = contents[currentlyOpen] as HTMLElement;
        prevContent.style.maxHeight = "0";
        prevContent.style.opacity = "0";
        prevContent.style.transform = "translateY(-8px)";

        triggers[currentlyOpen].setAttribute("aria-expanded", "false");
        names[currentlyOpen].classList.remove("text-accent");
      }

      const content = contents[index] as HTMLElement;
      const scrollHeight = content.scrollHeight;

      content.style.maxHeight = `${scrollHeight}px`;
      content.style.opacity = "1";
      content.style.transform = "translateY(0)";

      triggers[index].setAttribute("aria-expanded", "true");
      names[index].classList.add("text-accent");

      currentlyOpen = index;
    }
  }

  document.querySelectorAll(".venue-trigger").forEach((trigger) => {
    trigger.addEventListener("click", (e) => {
      const index = parseInt(
        (e.currentTarget as HTMLElement).dataset.venueIndex || "0",
      );
      toggleVenue(index);
    });
  });
</script>

<script>
  import { getInitialLanguage, getTranslations } from '../lib/i18n';
  import type { Language } from '../lib/i18n';

  let currentLanguage: Language = getInitialLanguage();

  function updateVenuesTranslations() {
    const t = getTranslations(currentLanguage);

    const titleEl = document.getElementById('venues-title');
    if (titleEl) titleEl.textContent = t.venues.title;
  }

  window.addEventListener('languagechange', ((e: CustomEvent) => {
    currentLanguage = e.detail.language;
    updateVenuesTranslations();
  }) as EventListener);

  updateVenuesTranslations();
</script>

<style>
  .venue-trigger {
    cursor: pointer;
  }

  .venue-trigger:hover .venue-name {
    color: var(--accent);
  }

  .venue-content {
    transition:
      max-height 350ms ease-out,
      opacity 350ms ease-out,
      transform 350ms ease-out;
  }

  :root {
    --accent: #c6a75e;
  }
</style>
